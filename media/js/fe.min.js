var _mes=["","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];var base="";var base_ol="";var is_portal=false;var layout;var num_carga=20;var cargar_mas=0;var _cluster=true;var resetLimit=false;var acceso=false;var _year,_month,_day,_today;var ocultar="";var cp_ecs={};var titulo;var totales_ini=true;var id_start_date="ini_date";var id_end_date="fin_date";var subtotales;var sidi_url="http://sidi.salahumanitaria.co/sissh";function setSubtotales(){var b=subtotales.dn;$bt=$("#chart_subtotal");var a="";for(s in b){var e=b[s];if(e>0){a+='<div style="background-color: #f2f2f2;margin:1px;padding: 3px"><div style="float:left">'+s+'</div><div id="hectareas" class="right">'+numberWithCommas(b[s])+'</div><div class="clear"></div></div>'}}$bt.html(a)}$(function(){_today=new Date();_year=_today.getFullYear();_month=_today.getMonth();_day=_today.getDate();var n=2;var p=7;var l=new Date(_year,_month,_day,0,0).getTime();var f=new Date(l-daysToMiliseconds(p));var o=f.getDate();var i=f.getMonth();var q=f.getFullYear();var g=f.getTime();var b=new Date(_year,_month,_day,23).getTime();$("#"+id_start_date).val(g/1000);$("#"+id_end_date).val(b/1000);markIniFin(o,i,q,_day,_month,_year);setYear("ini",q);setYear("fin",_year);$("#fen_nino").click(function(){filterByPeriod(1,2,2015,_day,_month,_year);$("#fcat_dn").find(".tn_fcat").click();$.each([1,3,8],function(t,v){var u=$("#cat_dn_"+v);u.iCheck("check");u.attr("checked",a)});setCatsHidden();addFeatures("dn");totalesxDepto();setTimeout(function(){var t="Fenómeno del niño - Afectados";var w="Fenómeno del niño - Eventos";$("#tgt").html(t);$("#chart_total").find(".ec").hide();$t=$("#chart_total");$t.css("width","100%");var v=$("#chart_total").find(".dn").find(".total_t");var u="total personas afectadas fenómeno del niño";v.html(u);$bt=$("#chart_subtotal");$bt.removeClass("left").removeClass("ec");setSubtotales();setTimeout(function(){$("#chart_1, #charts_pie").hide()},500);ocultarViolenciaDesastres("ec");$("div.mapa_tipo").click(function(){setTimeout(function(){$("#chart_1, #charts_pie").hide();if($(this).data("tipo")=="eventos"){v.html("total eventos fenómeno del niño");$bt.hide();$("#tgt").html(w)}else{v.html(u);$bt.show();$("#tgt").html(t)}},1000)});$("#depto_dropdown").on("click","li",function(){setTimeout(setSubtotales,500);setTimeout(function(){$("#chart_1, #charts_pie").hide()},1000)})},1000)});if(typeof portal!=="undefined"){is_portal=true}if(typeof layout==="undefined"){layout="monitor"}set100Height();$(window).resize(function(){set100Height()});$(document).ajaxStart(function(){HoldOn.open({theme:"sk-dot"})}).ajaxStop(function(){HoldOn.close()});$("#lmh").click(function(){m({t:"Monitor - SalaHumanitaria",hid:"qlmh",w:850,h:400});return false});$menu_li=$("#menu").find("li.sub");$menu_li.click(function(){$(".filtro").fadeOut(100);var t=$("#"+$(this).data("div"));var u=30*t.data("index")+"px";t.css("top",u);t.fadeIn(100);$menu_li.removeClass("menu_activo");$(this).addClass("menu_activo")});if(layout=="monitor"){$("input").iCheck({checkboxClass:"icheckbox_square-orange",radioClass:"iradio_square-orange"});$(".btn_fcat").click(function(){setCatsHidden();var t=$(this).data("inst");acceso=false;if(t=="acceso"){$("#btn_show_dn").html("Mostrar eventos");acceso=true}addFeatures(t);totalesxDepto();$(this).closest(".filtro").hide()});$(".btn_show_e").click(function(){var t=$(this).data("s");ocultarViolenciaDesastres(t);$(this).closest(".filtro").hide()});var a=false;$(".tn_fcat").click(function(){$(this).closest(".filtro").find("input:checkbox").each(function(){if(a===false){$(this).iCheck("uncheck")}else{$(this).iCheck("check")}$(this).attr("checked",a)});a=!a;return false});$("input.cp:checkbox").on("ifClicked",function(){var t=$(this).attr("checked");if(t){$(this).iCheck("uncheck")}else{$(this).iCheck("check")}$(this).attr("checked",!$(this).attr("checked"));$(this).closest("ul.cats").find("input.ch:checkbox").each(function(){if(t){$(this).iCheck("uncheck")}else{$(this).iCheck("check")}})});$("#minmax_total").toggle(function(){$(".ui-tabs-panel").hide();$(this).removeClass("minimize");$(this).addClass("maximize")},function(){$(".ui-tabs-panel").show();$(this).addClass("minimize");$(this).removeClass("maximize")});var k=false;$("#totalxd_all_chk").click(function(){$("#table_totalxd").find(":checkbox:not(:first)").each(function(){$(this).attr("checked",k)});k=!k});$("#filter_states").click(function(){addFeaturesFirstTime();totalesxDepto()});$("#download_incidents").click(function(){$("#loading").show();$.ajax({url:"download_incidents/"+$('input[name="descargar_v_d"]:checked').val(),success:function(){$("#loading").hide();location.href=base+"/export/xls/incidentes/Monitor-Incidentes"}})});$(".menu_totales").click(function(){if(totales_ini){totalPeriodo("y",_year);totales_ini=false}});$("#total_periodo_yyyy").change(function(){totalPeriodo("y",$(this).val())});$("a.close").click(function(){$(this).closest(".filtro").hide();$('li[data-div="'+$(this).attr("data-div")+'"]').removeClass("menu_activo")});$(".filtro_fecha").find("div.close").click(function(){$(this).closest(".filtro_fecha").hide()});$("input[name=rap]").on("ifClicked",function(t){applyPeriod($(this).val())});$("li.menu_totales").click(function(){if(totales_inicio){totalPeriodo(_year);totales_inicio=false}});$("#btn_variacion").click(function(){variacion();$(this).closest(".filtro").hide()});var e=document.getElementById("slide_cluster_bar");var h=4;noUiSlider.create(e,{start:[h/2],step:1,connect:"lower",range:{min:0,max:h}});e.noUiSlider.on("change",function(t,u){$("#group_level").val(Math.round(t[u])-(h/2));addFeatures()})}$(".mapa_tipo:not(.active)").click(function(){var t=this;$.ajax({url:"session_var/mapa_tipo/"+$(t).data("tipo"),success:function(){$(".mapa_tipo").removeClass("menu_activo");$(t).addClass("menu_activo");addFeaturesFirstTime();totalesxDepto()}})});$("#group_fts").click(function(){$(".cat_color").toggle();_cluster=!_cluster;var t=(_cluster)?"Desagrupado":"Agrupado";$(this).find("span").html(t);addFeaturesFirstTime();totalesxDepto();$("#tabs").tabs("select",1)});$("#layers").click(function(){$("#layers_div").toggle()});$("#layers_div").on("ifClicked",":checkbox",function(u){var x=$(this);var w=x.closest("li");var t=true;if(x.is(":checked")){t=false;w.removeClass("selected")}else{w.addClass("selected")}addWMSLayer(x.val(),x.val(),t)});$("#depto").click(function(){$("#depto_dropdown").toggle()});$("#depto_dropdown").on("click","li",function(){$li=$(this);$chks=$("#table_totalxd").find(":checkbox");mapLoad=0;if($li.data("value")==0){$chks.prop("checked",true);resetMap()}else{$chks.each(function(){chk=($(this).val()==$li.data("value"))?true:false;$(this).prop("checked",chk)});selDepto($li.data("centroid"))}var t=($li.html()!="Todos")?$li.html():"Colombia";$("#depto_t").html(t);addFeatures();totalesxDepto()});$("#collapse").click(function(){$(".op").toggle();$(this).toggleClass("expand")});if(layout!="monitor"){$("#stime").change(function(){applyPeriod($(this).val());addFeatures();totalesxDepto()})}$(".resumen_row","#resumen_ec").live("click",function(){$("#fcat_ec").find("input:checkbox").attr("checked",false);$("#fcat_ec").find("input:checkbox[value="+$(this).attr("id")+"]").attr("checked",true);setCatsHidden();addFeatures("ec");totalesxDepto()});if(layout!="portal_home"){setCatsHidden();if($("#tabs").length>0){$("#tabs").tabs()}$(".fecha").click(function(){var t=$(this).data("div");$("div.filtro_fecha:not(#"+t+")").hide();$("#"+t).slideToggle()});$("div.filtro_fecha").each(function(){var t=this;$(this).find("li").click(function(){$(this).closest("div").find("li").removeClass("selected");$(this).addClass("selected");var z=$(this).data("q");var v=$("#"+z+"_div");if(v.find("li.selected").length==3){var y=$(this).closest("fieldset").find('div.filtro_fecha[data-if="ini"]');var x=$(this).closest("fieldset").find('div.filtro_fecha[data-if="fin"]');var A=$("#"+z+"_text");var w=new Date(y.find("ul.yyyy > li.selected").data("val"),y.find("ul.mes > li.selected").data("val")-1,y.find("ul.dia > li.selected").data("val"),23,59).getTime();var u=new Date(x.find("ul.yyyy > li.selected").data("val"),x.find("ul.mes > li.selected").data("val")-1,x.find("ul.dia > li.selected").data("val"),23,59).getTime();if(w>u){alert("Desde debe ser menor que Hasta");A.val("");v.find("li").removeClass("selected")}else{A.val(v.find("ul.dia > li.selected").text()+" de "+v.find("ul.mes > li.selected").text()+" "+v.find("ul.yyyy > li.selected").text());y.find("input:hidden").val(w/1000);x.find("input:hidden").val(u/1000)}}})});$("div.filtro_fecha").find(".close").click(function(){$("div.filtro_fecha").slideUp()});$("#lff").click(function(){var u=getStartEnd("ini");var t=getStartEnd("fin");if(u>t){alert("La fecha Desde debe ser menor que la fecha Hasta")}else{addFeaturesFirstTime();totalesxDepto()}return false})}checkCacheJson();totalesxDepto();mapRender();var r=$("#table_totalxd");r.find(":checkbox").live("click",function(){if($(this).is(":checked")){$(this).closest("tr").removeClass("unselected")}else{$(this).closest("tr").addClass("unselected")}});$.ajax({url:"geonode_layers.html",success:function(t){$ul=$("#layers_ul");$ul.append(t);$ul.append($ul.find("li").sort(function(v,u){aa=$(v).find("h3").text();bb=$(u).find("h3").text();return aa==bb?0:aa<bb?-1:1}));$ul.find("input").iCheck({checkboxClass:"icheckbox_square-orange",radioClass:"iradio_square-orange"})}});$("#layers_search").keyup(function(t){clearTimeout($.data(this,"timer"));if(t.keyCode==13){search(true)}else{$(this).data("timer",setTimeout(search,500))}})});function search(e){var f=$("#layers_search");var a=f.val();if(!e&&a.length<3){return}var b=$("#layers_ul li");b.each(function(){var h=new RegExp(a,"i");$(this).show();var g=h.exec($(this).html());if(g===null){$(this).hide()}});f.focusout(function(){b.fadeOut(100)})}function ocultarViolenciaDesastres(b){var a;if(b=="ec"){ly=l_ec;$r_hide=$("#resumen_ec");$r_show=$("#resumen_dn")}else{ly=l_dn;$r_hide=$("#resumen_dn");$r_show=$("#resumen_ec")}var e=$('div[data-s="'+b+'"]');if(ly.getVisible()){e.html("Mostrar eventos");ly.setVisible(false);a=false;$r_hide.hide();$r_show.removeClass("left half");ocultar=b}else{e.html("Ocultar eventos");ly.setVisible(true);a=true;$r_hide.show();$r_show.addClass("left half");ocultar=""}l_ft.setVisible(!l_ft.getVisible());if($("#chart_1").highcharts()!==undefined){$("#chart_1").highcharts().get(b).setVisible(a,true)}if(b=="ec"){$("#charts_pie").toggle()}$("#table_totalxd").find("."+b).hide()}function applyPeriod(h){if(h!=0){var e=getStartEnd("ini");var a=getStartEnd("fin");var f=new Date(_year,_month,_day,0,0);var i=f.getTime();switch(h){case"acum":e=new Date(_year,0,1);a=_today;showGroupUngroup("show");break;case"m":e=new Date(i-daysToMiliseconds(30));a=_today;showGroupUngroup("show");break;case"s":e=new Date(i-daysToMiliseconds(7));a=_today;showGroupUngroup("show");break;case"ay":e=new Date(i-daysToMiliseconds(1));a=_today;showGroupUngroup("show");break;case"h":e=new Date(i);a=_today;showGroupUngroup("show");break;default:e=new Date(h,0,1);a=new Date(h,11,31);showGroupUngroup("false");break}$("#"+id_start_date).val(e/1000);$("#"+id_end_date).val(a/1000);var b=e.getFullYear();var g=a.getFullYear();setYear("ini",b);setYear("fin",g);markIniFin(e.getDate(),e.getMonth(),b,a.getDate(),a.getMonth(),g);resetLimit=true;cargar_mas=0}}m=function(a){if($("#dialog").size()){$("#dialog").dialog("destroy")}else{$("body").append('<div id="dialog"></div>')}if(a.hid){$("#dialog").html($("#"+a.hid).html())}else{if(a.html){$("#dialog").html(a.html)}else{if(a.u){$("#dialog").load(a.u,function(f,e,b){if(e=="error"&&b.status==403){window.location.href="/"}})}}}sm(a)};sm=function(a){$("#dialog").dialog({height:(a.h?a.h:500),width:(a.w?a.w:900),modal:true,title:a.t,open:a.funOpen?a.funOpen:null,close:function(){$(this).dialog("destroy");$(this).remove()}})};listReportsEvents=function(){$(".report_list_map").each(function(){$(this).hover(function(){$(this).find(".opt").show()},function(){$(this).find(".opt").hide()})});$(this).find(".d").click(function(){$(this).closest("div.fc").find(".hide").slideToggle()})};totalesxDepto=function(k){var e=getStartEnd("ini");var a=getStartEnd("fin");var l=$("#currentCatE").val()+"|"+$("#currentCatD").val();var g;var i;_states=getStatesChecked();if(layout=="portal_home"){$.ajax({url:base+"/getResumenPortalHome/"+e+"/"+a,dataType:"jsonp",success:function(p){for(j in p){$("#"+j).html(p[j]["t"]);$("#"+j+"_div").data("index",p[j]["v"])}var o=$("#resumen");o.append($("div.r").sort(function(r,q){return $(q).data("index")-$(r).data("index")}));for(j in p){if(p[j]["v"]==0){$("#"+j).html("--")}}}})}else{if(layout=="portal"){if(typeof k==="undefined"){$(".tab_data").html("")}var h;if(resetLimit){h=0}else{h=cargar_mas*num_carga}var f=["ec","dn"];if(h==0){$(".tab_data").html('<div>&nbsp;&nbsp;<img src="'+base+'/media/img/ajax-loader-mini.gif" />&nbsp;Cargando datos...</div>')}$.ajax({url:base+"/getIncidentesPortal/"+e+"/"+a+"/"+l+"/"+h+"/"+_states,dataType:"jsonp",beforeSend:function(){$("#loading").show()},success:function(u){i=u.t;num_e=u.t_e;num_d=u.t_d;g=u.e.length;$("#num_total_span").html(i);$("#num_total_ec_span").html(num_e);$("#num_total_dn_span").html(num_d);var q="";if(g>0){for(var t=0,r=g;t<r;t+=1){_js=u.e[t];_dt=_js.d.split(/\W+/);_date=[_dt[2],_mes[_dt[1]*1],_dt[0]].join(" ");q+='<div class="clear report_list_map report_list_map_'+_js.sys+'"> <div class="l '+_js.sys+'"> '+_js.sys.substring(0,1).toUpperCase()+'</div> <div class="t clear">'+_js.t+'</div> <div class="hide"><div class="date detail">'+_js.d+'</div> <div class="loc detail">'+_js.ln+' <span class="pdf opt"> <a href="'+sidi_url+"/download_pdf.php?c=2&id_depto="+_js.ld+'&id_mun=" target="_blank">Perfil '+_js.ldn+"</a></span></div> </<div></div>";q+='<div class="clear hide"><div class="left"><b>Categorias</b></div> <div class="opt right linko"><a href="http://www.salahumanitaria.co/gtmi/wiki/index.php/Sistema_de_categor%C3%ADas_del_m%C3%B3dulo_de_eventos_de_conflicto" target="_blank">Definici&oacute;n</a></div>';for(c in _js.c){q+='<div class="clear cat">&raquo;&nbsp;'+c;if(_js.c[c].length>0){q+=": "}for(d in _js.c[c]){if(d>0){q+=", "}q+=_js.c[c][d]}q+="</div>"}q+="</div>";q+='<div class="clear"></div> ';if(show.desc){q+='<div class="desc hide"><b>Descripci&oacute;n</b>: '+_js.desc+"</div> "}if(show.fuente){if(_js.f!=""){q+='<div class="f hide"><div class="ft">Fuente de noticia</div>';for(var p=0,o=_js.f.length;p<o;p+=1){q+='<div class="fc">';if(_js.f[p][0]!=""&&_js.f[p][1]!=""){q+='<div class="fct">'+_js.f[p][0]+" :: "+_js.f[p][1]+"</div>"}if(_js.f[p][3]!=""){q+='<div class="fcc"><b>Descripci\u00f3n tomada de la fuente</b>: "'+_js.f[p][3]+'"</div>'}if(_js.f[p][2].indexOf("http")!=-1){q+='<div class="fcc"><a href="'+_js.f[p][2]+'" target="_blank">'+_js.f[p][2]+"</a></div></div> "}}q+="</div>"}}q+="</div></div>"}if((h+num_carga)<i){q+='<div id="cargar_mas"><div class="btn cargar_mas">Cargar mas eventos</div></div>'}}else{q='<div class="no">No hay eventos registrados</div>'}$div=$("#incidentes");if(h==0){$div.html(q)}else{$div.find(".cargar_mas").remove();$div.append(q)}$(".cargar_mas").click(function(){cargar_mas+=1;totalesxDepto(true);return false});if(_states!=0){selDepto($("#state").attr("centroid"))}$("#loading").hide();resumenAfectacion(u);charts(u.charts);$("#loading_data").hide()}})}else{titulo=(getMapaAfectacion()==1)?"afectados":"eventos";if(acceso){titulo="restricción <br /> al acceso"}var b=$("#ini_text").val();var n=$("#fin_text").val();$("#titulo_general").find("#tgt").html("Mapa de "+titulo);$("#titulo_general").find("#tgc").html(b+" - "+n);$("#table_totalxd tbody").html('<tr><td colspan="4"><img src="media/img/ajax-loader-mini.gif" />&nbsp;Actualizando datos...</td></tr>');$.ajax({url:base+"/totalxd/"+e+"/"+a+"/"+l+"/"+_states,dataType:"json",success:function(q){$("#table_totalxd tbody tr").remove();var v=q.t;var u;var x=true;var w=$("#table_totalxd tbody");var o=$("#depto_dropdown");var r=w.html();var p="<li data-value=0>Todos</li>";r+='<tr class="totalxd"><td class="left">Total</td><td class="ec">'+v.ec+'</td><td class="dn">'+v.dn+"</td></tr>";for(var t in q.r){_i=q.r[t];u=(_i.css=="")?"checked":"";if(x&&(_i.ec>0||_i.dn>0)){x=false}r+='<tr class="f '+_i.css+" "+_i.hide+'"><td class="hide"><input type="checkbox" name="deptos[]" value="'+_i.state_id+'" '+u+' /></td><td class="n left">'+_i.d+'</td><td class="ec">'+_i.ec+'</td><td class="dn">'+_i.dn+'</td><td class="hide centroid">'+_i.c+"</td></tr>";p+='<li class="'+_i.hide+'" data-value="'+_i.state_id+'" data-centroid="'+_i.c+'"> '+_i.d+"</li>"}if(x){r+='<tr><td colspan="4"><br />No existen eventos</td></tr>'}w.html(r);o.html(p);resumenAfectacion(q);charts(q.charts);subtotales=q.subtotales;$("#loading_data").hide()}})}}};resumenAfectacion=function(g){var b=(getMapaAfectacion()==1)?"personas afectadas":"eventos";var e=0;$("#resumen_ec, #resumen_dn").find(".resumen_row:not(:first)").remove();$resumen_ec=$("#resumen_ec");for(var h in g.rsms_ec){$div=$(".resumen_row:first").clone();$div.removeClass("hide");$div.addClass("ect");rsm=g.rsms_ec[h];$div.attr("id",rsm.cat_id);$div.find(".num").html(numberWithCommas(rsm.n));$div.find(".cat").html(rsm.t);$div.find(".cat_color").css("background-color","#"+rsm.c);if(rsm.n>0){$resumen_ec.append($div)}}e=numberWithCommas(g.t.ec);$("#chart_total_v").html(e);if(g.t.ec>0){$("#resumen_total_ec_num").html(e);$resumen_ec.show()}else{$resumen_ec.hide()}$resumen_dn=$("#resumen_dn");var a=0;for(var h in g.rsms_dn){$div=$(".resumen_row:first").clone();$div.removeClass("hide");$div.addClass("dnt");rsm=g.rsms_dn[h];$div.find(".num").html(numberWithCommas(rsm.n));$div.find(".cat").html(rsm.t);if(rsm.n>0){$resumen_dn.append($div)}}a=numberWithCommas(g.t.dn);$("#chart_total_d").html(a);if(g.t.dn>0){$("#resumen_total_dn_num").html(a);$resumen_dn.show()}else{$resumen_dn.hide()}if(g.t.ec>0&&g.t.dn>0){$("#resumen_ec, #resumen_dn").addClass("left half")}else{$("#resumen_ec, #resumen_dn").removeClass("left half")}$(".data_title").html(b);if(ocultar!=""){$r=$("#resumen_"+ocultar);$r.hide();if(ocultar=="ec"){$("#resumen_dn").removeClass("left half")}else{$("#resumen_ec").removeClass("left half")}}if(g.subtotales.ec!==undefined){var f=g.subtotales.ec;$("#civiles").html((f.civiles===undefined)?"---":numberWithCommas(f.civiles));$("#hombres").html((f.hombres===undefined)?"---":numberWithCommas(f.hombres));$("#mujeres").html((f.mujeres===undefined)?"---":numberWithCommas(f.mujeres));$("#menores").html((f.menores===undefined)?"---":numberWithCommas(f.menores));$("#afros").html((f.afros===undefined)?"---":numberWithCommas(f.afros));$("#indigenas").html((f.indigenas===undefined)?"---":numberWithCommas(f.indigenas))}};charts=function(k){Highcharts.setOptions({chart:{style:{fontFamily:"Arial",fontSize:"11px"}},yAxis:{min:0}});var i={fontSize:"14px",margin:0};if(k[0].data.length==0){$("#chart_1").html("<h2>No hay información</h2>");return}var h=k[0];$("#chart_1").highcharts({chart:{type:"line",width:350,height:200,style:{}},legend:{enabled:false},plotOptions:{series:{marker:{radius:3}}},title:{text:titulo.toUpperCase(),style:i},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b",year:"%b"},gridLineWidth:1,lineColor:"#000",tickColor:"#000"},yAxis:h.yAxis,series:h.data});if(k.length>2){$("#charts_pie").show();var a=[30,30,10,30];var g=180;var e=350;var b={allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true,distance:20,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"}};var f={stacking:"normal"};var h=k[1];$("#chart_2").highcharts({chart:{type:"pie",width:e,height:g,margin:a,style:{}},plotOptions:{pie:b},title:{text:h.title,style:i},series:[{data:h.data}]});var h=k[2];$("#chart_3").highcharts({chart:{type:"pie",width:e,height:g,margin:a,style:{}},plotOptions:{pie:b},title:{text:h.title,style:i},series:[{data:h.data}]})}else{$("#charts_pie").hide()}};forceSortTable=function(){var a=[[1,1]];$("#table_totalxd").trigger("update");$("#table_totalxd").trigger("sorton",[a])};setCatsHidden=function(){var a=[];$("#fcat_ec").find("input.ch:checked").each(function(){a.push($(this).val())});$("#currentCatE").val(a);a=[];$("#fcat_dn").find("input.ch:checked").each(function(){a.push($(this).val())});$("#currentCatD").val(a)};daysToMiliseconds=function(a){return a*24*3600*1000};getStartEnd=function(b){var a=[];a.ini=$("#"+id_start_date).val();a.fin=$("#"+id_end_date).val();return a[b]};getYear=function(a){return $("#yyyy_"+a).val()};setYear=function(g,f){$("#yyyy_"+g).val(f);var b=getStartEnd();var e=new Date(getStartEnd("ini")*1000);var a=new Date(getStartEnd("fin")*1000);$("#periodo_texto").html(e.getDate()+"-"+_mes[1+e.getMonth()]+" "+e.getFullYear()+" al "+a.getDate()+"-"+_mes[1+a.getMonth()]+" "+a.getFullYear())};markIniFin=function(a,i,e,b,k,f){var h="selected";i=i+1;k=k+1;$("#ini_div,#fin_div").find("li").removeClass("selected");var l=$("#ini_div");var g=$("#fin_div");l.find("ul.dia > li[data-val="+a+"]").addClass(h);l.find("ul.mes > li[data-val="+i+"]").addClass(h);l.find("ul.yyyy > li[data-val="+e+"]").addClass(h);g.find("ul.dia > li[data-val="+b+"]").addClass(h);g.find("ul.mes > li[data-val="+k+"]").addClass(h);g.find("ul.yyyy > li[data-val="+f+"]").addClass(h);$("#ini_text").val(a+" de "+_mes[i]+" "+e);$("#fin_text").val(b+" de "+_mes[k]+" "+f)};getStatesChecked=function(){var a=[];var b=$("#table_totalxd");if(b.find(":not(:checked)").length>0){b.find(":checked").each(function(){if($(this).val()!=0){a.push($(this).val())}})}return a.join(",")};getMapaAfectacion=function(){return($(".mapa_tipo.menu_activo").data("tipo")=="eventos")?0:1};getAccesoCats=function(){var a=[];$("#fcat_list_acceso").find(":checked").each(function(){a.push($(this).val())});return a.join(",")};showGroupUngroup=function(a){$btn=$("#group_fts");if(a=="show"){$btn.show()}else{$btn.hide()}};function numberWithCommas(b){var a=b.toString().split(".");return a[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")+(a[1]?"."+a[1]:"")}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};set100Height=function(){var a=$(document).height()-$("#brand").height()-20;$(".map_monitor").css("height",a-5-$("#header").height());$("#menu").css("height",a)};setMapWidth=function(){$(".map_monitor").css("width",$(document).width())};totalPeriodo=function(e,a){$.ajax({url:"totalPeriodo/violencia/"+e+"/"+a,success:function(f){$o=$("#totales_data_violencia");$o.find("tr:not(:first)").remove();$o.append(f)}});$.ajax({url:"totalPeriodo/desastres/"+e+"/"+a,success:function(f){$o=$("#totales_data_desastres");$o.find("tr:not(:first)").remove();$o.append(f)}});var b="z/monitor-totales";$("#total_descarga_v").attr("href",b+"-"+a+"-violencia.xls");$("#total_descarga_d").attr("href",b+"-"+a+"-desastres.xls")};checkCacheJson=function(){$.ajax({url:"checkCacheJson"})};variacion=function(){var a=$("#variacion_p1_ini_date").val();var i=$("#variacion_p1_fin_date").val();var h=$("#variacion_p2_ini_date").val();var e=$("#variacion_p2_fin_date").val();var g=$('input[name="variacion_v_d"]:checked').val();if(g=="v"){var b=$("#currentCatE").val()}else{var b=$("#currentCatD").val()}var f=getStatesChecked();$("#loading").show();$.ajax({url:"variacion/"+a+"|"+i+"/"+h+"|"+e+"/"+g+"/"+b+"/"+f,success:function(o){$("#loading").hide();addLayerVariacion(o.values);var k=$("#variacion_data");var n=($('input[name="variacion_v_d"]:checked').val()=="v")?"violencia armada":"vesastres";var l='<h2 class="ac">Variación '+n+'</h2> <div class="variacion_periodo"><b>Periodo 1</b><br /> '+$("#variacion_p1_ini_text").val()+" al <br /> "+$("#variacion_p1_fin_text").val()+'</div><div class="variacion_periodo"><b>Periodo 2</b><br /> '+$("#variacion_p2_ini_text").val()+" al <br /> "+$("#variacion_p2_fin_text").val()+'</div><div class="clear"></div><h2 class="ac"><br />Datos municipales</h2><div class="ac">La variación se calcula sobre el # de eventos<br />&nbsp;</div>';l+=o.html;k.html(l);k.find("table").DataTable({order:[[2,"desc"]],pageLength:30,scrollY:"400px",lengthChange:false,language:{searchPlaceholder:"Buscar municipio",search:""},columnDefs:[{targets:[0],visible:false}]});var p=$("div.dataTables_filter");p.append('<i class="fa fa-download"></i> <a href="z/monitor-variacion.xls">Descargar a excel</a>')}})};function addLayerVariacion(g){var k=new geostats(g);k.setPrecision(6);var f=k.getClassJenks(5);var e=k.ranges;var b=new Array("#36B446","#F0E62C","#E59322","#EF3326","#700909");k.setColors(b);var i=e;k.setPrecision(2);k.legendSeparator=" ⇔ ";var h=k.getHtmlLegend(null,"Variación %");$("#variacion_legend").html(h+"<p>Mapa: puede consultar la información de un municipio haciendo click sobre él</p>");if(!layer_variacion_exists){l_variacion=new ol.layer.Vector({source:new ol.source.Vector({url:"static/variacion-topo.json",format:new ol.format.TopoJSON()}),style:function(l,a){if(l.get("variacion")!==undefined){styleObj={fill:new ol.style.Fill({color:b[k.getClass(l.get("variacion"))]}),stroke:new ol.style.Stroke({color:"gray",width:1})}}else{styleObj={stroke:new ol.style.Stroke({color:"gray",width:1})}}return[new ol.style.Style(styleObj)]}});map.addLayer(l_variacion);layer_variacion_exists=true}else{l_variacion.getSource().changed()}showHideLayers("variacion")}function filterByPeriod(h,b,a,e,g,f){_ini=new Date(a,b,h,0);_fin=new Date(f,g,e,23);$("#"+id_start_date).val(_ini/1000);$("#"+id_end_date).val(_fin/1000);markIniFin(h,b,a,e,g,f)};